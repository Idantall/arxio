# תיקונים נוספים למערכת הסריקות

## בעיות שתוקנו:

1. **בעיית שם השדה scan_type/type**:
   - הבעיה: חוסר התאמה בין שמות השדות בטבלת הסריקות: בשאילתה השתמשו ב-scan_type בעוד בדפי הסריקות מנסים לגשת לשדה type
   - הפתרון: 
      - שינוי שם השדה בשאילתות SQL ל-scan_type
      - עדכון קוד מיפוי הנתונים להשתמש ב-scan_type במקום type

2. **בעיית האימות בעת יצירת סריקה חדשה**:
   - הבעיה: הודעת "לא ניתן לזהות את המשתמש במערכת. יש להתחבר מחדש"
   - הפתרון:
      - תיקון הנתיב לקבלת מזהה המשתמש ל-`/api/user/get-id`
      - שיפור קוד הטיפול ב-tryFixUserAuth כולל לוגים ורענון העמוד
      - הוספת שליחת עוגיות אימות בפניה ל-API

3. **שינוי בקריאה ל-API לפתיחת סריקה**:
   - הבעיה: השם שגוי של שדה סוג הסריקה בבקשה 
   - הפתרון:
      - שינוי שדה type ל-scanType בקוד שמכין את הבקשה

## קבצים שתוקנו:

1. **apps/web/app/api/projects/[id]/scans/route.ts**:
   - תיקון שם השדה מ-type ל-scan_type בבחירת שדות ובקוד המיפוי

2. **apps/web/app/api/scans/route.ts**:
   - עדכון סכמת טבלת הסריקות עם שם השדה scan_type במקום type

3. **apps/web/app/dashboard/projects/[id]/page.tsx**:
   - תיקון נתיב לקבלת מזהה המשתמש
   - שיפור הטיפול בתיקון אימות המשתמש
   - שינוי שדה type ל-scanType בהכנת הבקשה

## בדיקות שיש לבצע כעת:

1. **יצירת סריקה חדשה** - בדוק שניתן ליצור סריקה חדשה ללא שגיאת אימות משתמש

2. **שליפת סריקות** - בדוק שכל הסריקות נשלפות ומוצגות כראוי ללא שגיאת "column scans.scan_type does not exist"

3. **מידע מפורט** - בדוק שמידע מפורט של הסריקות, כולל findings_count, מוצג כראוי 